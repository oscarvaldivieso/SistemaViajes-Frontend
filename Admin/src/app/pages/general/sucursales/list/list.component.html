<!-- Custom Breadcrumb Header -->
<app-breadcrumbs [title]="'Sucursales'" [icon]="'ri-map-pin-2-line'" [badgeIcon]="'ri-store-2-line'"
  [badgeCount]="sucursales.length" [breadcrumbItems]="[
    { label: 'General' },
    { label: 'Sucursales', active: true }
  ]">
</app-breadcrumbs>

<div class="row">
  <div class="col-lg">
    <!-- Toolbar: Button + Search -->
    <div class="card mb-3">
      <div class="card-body">
        <div class="row align-items-center justify-content-between gy-2">
          <!-- Left: New Button -->
          <div class="col-md-auto">
            <a routerLink="/general/sucursales/create" class="btn btn-primary">
              <i class="ri-add-line align-baseline me-1"></i> Nueva Sucursal
            </a>
          </div>

          <!-- Right: Search -->
          <div class="col-md-3">
            <input type="text" class="form-control" placeholder="Buscar por nombre o código..."
              [(ngModel)]="searchTerm">
          </div>
        </div>
      </div>
    </div>

    <!-- Error Alert -->
    <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show mb-3" role="alert">
      <i class="ri-error-warning-line me-2"></i>
      <strong>Error:</strong> {{ errorMessage }}
      <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="text-muted mt-3">Cargando sucursales...</p>
    </div>

    <!-- Cards Grid -->
    <div class="row" id="property-list" *ngIf="!isLoading">
      <div class="col-xxl-3 col-lg-4 col-md-6" *ngFor="let sucursal of filteredSucursales(); let i = index">
        <div class="card real-estate-grid-widgets card-animate">
          <div class="card-body p-2">
            <img [src]="sucursal.sucu_Imagen || 'assets/images/small/img-placeholder.jpg'"
              alt="{{ sucursal.sucu_Nombre }}" class="rounded w-100 object-fit-cover" style="height: 180px">
            <div dropdown class="dropdown dropdown-real-estate">
              <button dropdownToggle class="btn btn-light btn-icon btn-sm" type="button"> <i
                  class="bi bi-three-dots-vertical"></i> </button>
              <ul *bsDropdownMenu class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item edit-list" href="javascript:void(0);"
                    [routerLink]="['/general/sucursales/details', sucursal.sucu_Id]"><i
                      class="bi bi-eye me-1 align-baseline"></i>
                    Ver detalles</a></li>
                <li><a class="dropdown-item edit-list" href="javascript:void(0);"
                    [routerLink]="['/general/sucursales/edit', sucursal.sucu_Id]"><i
                      class="bi bi-pencil-square me-1 align-baseline"></i>
                    Editar</a></li>
                <li><a class="dropdown-item remove-list" href="javascript:void(0);"
                    (click)="onDelete(sucursal.sucu_Id!)"><i class="bi bi-trash3 me-1 align-baseline"></i>
                    Eliminar</a></li>
              </ul>
            </div>
          </div>
          <div class="card-body p-3">
            <span class="badge bg-primary-subtle text-primary fs-xxs mb-3">
              <i class="ri-store-2-line align-baseline me-1"></i>{{ sucursal.sucu_Codigo }}
            </span>
            <a [routerLink]="['/general/sucursales/details', sucursal.sucu_Id]" class="text-dark text-decoration-none">
              <h6 class="fs-lg text-capitalize text-truncate">{{ sucursal.sucu_Nombre }}</h6>
            </a>
            <p class="text-muted"><i class="bi bi-geo-alt align-baseline me-1"></i> {{ sucursal.sucu_Direccion }}</p>
            <p class="text-muted mb-0"><i class="ri-map-pin-line align-baseline me-1"></i> {{ sucursal.muni_Codigo }}
            </p>

            <div class="border-top border-dashed mt-3 pt-3 d-flex align-items-center justify-content-between gap-3">
              <small class="text-muted">Usuario #{{ sucursal.usua_Creacion }}</small>
              <a [routerLink]="['/general/sucursales/details', sucursal.sucu_Id]" class="link-effect">Ver más<i
                  class="bi bi-chevron-right align-baseline ms-1"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div><!--end row-->

    <!-- No Results -->
    <div *ngIf="filteredSucursales().length === 0 && !isLoading" class="text-center py-4">
      <div class="avatar-md mx-auto mb-4">
        <div class="avatar-title bg-light text-primary rounded-circle fs-4xl">
          <i class="bi bi-search"></i>
        </div>
      </div>
      <h5 class="mt-2">{{ searchTerm ? 'No hay sucursales que coincidan con la búsqueda' : 'No hay sucursales para
        mostrar' }}</h5>
    </div>

    <!-- Pagination Info -->
    <div class="row align-items-center mb-4 justify-content-between text-center text-sm-start"
      *ngIf="!isLoading && sucursales.length > 0">
      <div class="col-sm">
        <div class="text-muted">
          Mostrando <span class="fw-semibold">{{ filteredSucursales().length }}</span> de <span class="fw-semibold">{{
            sucursales.length }}</span> sucursales
        </div>
      </div>
    </div>
  </div>
</div>