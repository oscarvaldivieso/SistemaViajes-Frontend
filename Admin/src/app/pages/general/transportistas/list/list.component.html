<!-- Custom Breadcrumb Header -->
<app-breadcrumbs [title]="'Transportistas'" [icon]="'ri-truck-line'" [badgeIcon]="'ri-user-star-line'"
    [badgeCount]="transportistas.length" [breadcrumbItems]="[
    { label: 'General' },
    { label: 'Transportistas', active: true }
  ]">
</app-breadcrumbs>

<div class="row">
    <div class="col-lg">
        <!-- Toolbar: Button + Search -->
        <div class="card mb-3">
            <div class="card-body">
                <div class="row align-items-center justify-content-between gy-2">
                    <!-- Left: New Button -->
                    <div class="col-md-auto">
                        <a routerLink="/general/transportistas/create" class="btn btn-primary">
                            <i class="ri-add-line align-baseline me-1"></i> Nuevo Transportista
                        </a>
                    </div>

                    <!-- Right: Search -->
                    <div class="col-md-3">
                        <input type="text" class="form-control" placeholder="Buscar por nombre o identidad..."
                            [(ngModel)]="searchTerm">
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Alert -->
        <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show mb-3" role="alert">
            <i class="ri-error-warning-line me-2"></i>
            <strong>Error:</strong> {{ errorMessage }}
            <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="text-muted mt-3">Cargando transportistas...</p>
        </div>

        <!-- Cards Grid -->
        <div class="row" id="transportistas-list" *ngIf="!isLoading">
            <div class="col-xxl-3 col-lg-4 col-md-6"
                *ngFor="let transportista of filteredTransportistas(); let i = index">
                <div class="card card-animate">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="avatar-sm flex-shrink-0">
                                <div class="avatar-title bg-primary-subtle text-primary rounded-circle fs-3">
                                    <i class="ri-truck-line"></i>
                                </div>
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <h6 class="mb-1 fs-15 text-truncate">{{ transportista.tran_NombreCompleto }}</h6>
                                <p class="text-muted mb-0">
                                    <i class="ri-user-star-line me-1 align-baseline"></i>ID: {{
                                    transportista.tran_Identidad }}
                                </p>
                            </div>
                        </div>

                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <div class="border rounded p-2">
                                    <p class="text-muted mb-1 fs-12">Teléfono</p>
                                    <h6 class="mb-0 fs-14">
                                        <i class="ri-phone-line me-1 text-success"></i>{{ transportista.tran_Telefono ||
                                        'N/A' }}
                                    </h6>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="border rounded p-2">
                                    <p class="text-muted mb-1 fs-12">Tarifa/Km</p>
                                    <h6 class="mb-0 fs-14">
                                        <i class="ri-money-dollar-circle-line me-1 text-warning"></i>L {{
                                        transportista.tran_TarifaPorKm | number:'1.2-2' }}
                                    </h6>
                                </div>
                            </div>
                        </div>

                        <div
                            class="border-top border-dashed mt-3 pt-3 d-flex align-items-center justify-content-between gap-3">


                            <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-warning"
                                    [routerLink]="['/general/transportistas/edit', transportista.tran_Id]">
                                    Editar
                                </button>
                                <button class="btn btn-sm btn-danger" (click)="onDelete(transportista.tran_Id!)">
                                    Eliminar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div><!--end row-->

        <!-- No Results -->
        <div *ngIf="filteredTransportistas().length === 0 && !isLoading" class="text-center py-4">
            <div class="avatar-md mx-auto mb-4">
                <div class="avatar-title bg-light text-primary rounded-circle fs-4xl">
                    <i class="bi bi-search"></i>
                </div>
            </div>
            <h5 class="mt-2">{{ searchTerm ? 'No hay transportistas que coincidan con la búsqueda' : 'No hay
                transportistas para
                mostrar' }}</h5>
        </div>

        <!-- Pagination Info -->
        <div class="row align-items-center mb-4 justify-content-between text-center text-sm-start"
            *ngIf="!isLoading && transportistas.length > 0">
            <div class="col-sm">
                <div class="text-muted">
                    Mostrando <span class="fw-semibold">{{ filteredTransportistas().length }}</span> de <span
                        class="fw-semibold">{{
                        transportistas.length }}</span> transportistas
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmación para Eliminar -->
<div class="modal fade" [ngClass]="{'show d-block': transportistaToDelete}"
    [style.display]="transportistaToDelete ? 'block' : 'none'" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-danger bg-gradient border-0 pb-3">
                <h5 class="modal-title text-white">
                    <i class="ri-delete-bin-line me-2"></i>Confirmar Eliminación
                </h5>
                <button type="button" class="btn-close btn-close-white" (click)="cancelDelete()"
                    [disabled]="isDeleting"></button>
            </div>
            <div class="modal-body p-4">
                <div class="text-center mb-4">
                    <div class="avatar-lg mx-auto mb-3">
                        <div class="avatar-title bg-danger-subtle text-danger rounded-circle fs-2">
                            <i class="ri-alert-line"></i>
                        </div>
                    </div>
                    <h5 class="mb-2">¿Estás seguro?</h5>
                    <p class="text-muted mb-0">Esta acción no se puede deshacer</p>
                </div>

                <div class="alert alert-warning border-0" role="alert" *ngIf="transportistaToDelete">
                    <div class="d-flex align-items-start">
                        <div class="flex-shrink-0">
                            <i class="ri-information-line fs-4"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="alert-heading mb-2">Transportista a eliminar:</h6>
                            <p class="mb-1"><strong>Identidad:</strong> {{ transportistaToDelete.tran_Identidad }}</p>
                            <p class="mb-1"><strong>Nombre:</strong> {{ transportistaToDelete.tran_NombreCompleto }}</p>
                            <p class="mb-0"><strong>Teléfono:</strong> {{ transportistaToDelete.tran_Telefono }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer bg-light border-0">
                <button type="button" class="btn btn-light" (click)="cancelDelete()" [disabled]="isDeleting">
                    <i class="ri-close-line me-1"></i>Cancelar
                </button>
                <button type="button" class="btn btn-danger" (click)="confirmDelete()" [disabled]="isDeleting">
                    <span *ngIf="!isDeleting">
                        <i class="ri-delete-bin-line me-1"></i>Sí, Eliminar
                    </span>
                    <span *ngIf="isDeleting">
                        <span class="spinner-border spinner-border-sm me-1"></span>Eliminando...
                    </span>
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal-backdrop fade" [ngClass]="{'show': transportistaToDelete}" *ngIf="transportistaToDelete"></div>